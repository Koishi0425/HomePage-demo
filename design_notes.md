# 设计说明

## MongoDB 选型理由
本项目强制选用 MongoDB，主要基于以下考量：
1.  **JSON 天然适配**: 核心功能「主页制作」生成的组件配置是复杂的嵌套 JSON 结构（`{ components: [...] }`）。MongoDB 的文档模型（BSON）可以直接存储和查询这些结构，无需像关系型数据库那样进行繁琐的序列化/反序列化或拆分多表。
2.  **灵活扩展**: 组件属性（Props）可能随业务发展频繁增加（如新增视频自动播放、图片滤镜等）。MongoDB 的 Schema-less 特性允许我们在不修改数据库结构的情况下动态添加字段。
3.  **弱关联数据**: 用户、插画、主页配置之间的关联相对简单，且读多写少，MongoDB 的高性能读取非常适合此类场景。

## 主页制作核心逻辑
1.  **拖拽交互**: 前端使用 `vuedraggable` 实现组件库到画布的拖拽。
2.  **数据流转**: 
    - 拖拽生成组件对象（含唯一 ID 和默认 Props）。
    - 画布状态维护一个组件数组 `canvasComponents`。
    - 点击保存/发布时，将该数组序列化为 JSON 发送给后端。
3.  **存储与渲染**:
    - 后端将 JSON 存入 `homepages` 集合的 `components_config` 字段。
    - 访问个人主页时，前端获取 JSON，通过 `<component :is="...">` 动态渲染对应组件。

## 潜在风险与应对
1.  **文档过大**: 如果用户添加过多组件，MongoDB 单个文档可能过大（虽上限 16MB，但影响传输）。
    - **应对**: 前端限制组件数量（如最多 50 个），后端接口层做校验。
2.  **XSS 攻击**: 用户可能在文本组件输入恶意脚本。
    - **应对**: 后端在保存前使用 `DOMPurify` 对文本内容进行严格过滤。
3.  **图片存储**: 本地存储图片在分布式部署下有问题。
    - **应对**: 代码中预留了 OSS 路径字段，生产环境应替换为云存储服务。
